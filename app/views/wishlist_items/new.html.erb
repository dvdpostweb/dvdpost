<% product = @product %>
<% test = product.good_language?(DVDPost.product_languages[I18n.locale]) %>

<div id="addwishlist_title" class="content-wishlist">
  <%= "#{product.title} (#{product.year})" %> 
</div>
<% if product.streaming? && streaming_access? %> 
<div id="addwishlist_vod">
  <p id="vod">
    <%= t '.title' %>
  </p>
  <% if product.streaming? %>
  <div class="availability streaming">
    <%= render :partial => 'products/streaming', :locals => {:product => product} %>
  </div>
  <% end %>
  <div id="vodadd" >
    <%= render :partial => 'products/vod_list', :locals => {:product => product} %>  </div> 
  <div class="clear"></div>
  <br />
  <div align="center" id="informations">
    <%= link_to t('.faq'), streaming_products_faq_path(), :target => "_blank" %>
  </div>
</div>
<% end %>
<% unless product.vod?  %>
  <div id="addwishlist_explain">
    <%= t '.intro' %>
  </div>
  <% @products.collect do |product| %>
    <% media = DVDPost.product_types.invert[product.media] %>
    <% if current_customer.wishlist_products.include?(product) %>
      <% title = title_remove_from_wishlist(:long, media) %>
      <% long_title = title_remove_from_wishlist(:long, media) %>

      <% wishlist_item = current_customer.wishlist_items.find_by_product_id(product.id) %>
      <% submit_id = "p_#{product.to_param}_#{rand(10)}"%>
      <% form_id = "form_#{product.to_param}_#{rand(10)}"%>
      <% form_for(:wishlist_item, :url => wishlist_item_path(:id => wishlist_item.to_param), :html => {:method => :delete, :id => form_id, :class => 'remvove_from_wishlist_form'}) do |f|%>
        <%= hidden_field_tag :source,  params[:source] %>
        <%= hidden_field_tag :text,   :long %>
        <%= hidden_field_tag :list,   1 %>
        <%= hidden_field_tag :load_color,  :normal %>
        <%= hidden_field_tag :submit_id,  submit_id %>
        <%= hidden_field_tag :form_id,  form_id %>
        <%= hidden_field_tag :product_id,  product.id %>
        <table width="500"><tr><td>format</td><td>language</td><td>sub</td><td>piority</td><td>button</td></tr>
        <tr>
          <td><%= t("products.index.filters.#{media}") %></td>
          <td><ul class="lang"><% audio_bubble = audio_bubbles(product, 20, :li)%><%= audio_bubble[:audio] unless audio_bubble[:audio].blank?%></ul></td>
          <td><ul class="lang"><% subtitles = subtitle_bubbles(product, 20, :li) %><%= subtitles[:sub] unless subtitles[:sub].blank?%></ul></td>
          <td></td>
          <td>
            <span id ="<%= submit_id %>">
              <%= submit_tag title, :class => 'remvove_from_wishlist btn_remove_form' %>
            </span>
          </td>
        </tr>
      <% end %>
    <% else %>
      <% form_for @wishlist_item do |f| %>
      <%= f.hidden_field :product_id, :value => product.id %>
      <%= f.hidden_field :wishlist_source_id, :value => params[:source] %>
      <%= hidden_field_tag :submit_id, @submit_id %>
      <%= hidden_field_tag :text, @text %>
      <%= hidden_field_tag :type, :classic %>
      <%= hidden_field_tag :load_color, :normal %>
      <%= hidden_field_tag :all_movies, 0 %>
      
      <% if @serie_id.to_i > 0 %>
        <%= hidden_field_tag :serie_id, @serie_id %>
      <% end %>
      <table width="500"><tr><td>format</td><td>language</td><td>sub</td><td>piority</td><td>button</td></tr>
      <tr>
        <td><%= t("products.index.filters.#{media}") %></td>
        <td><ul class="lang"><% audio_bubble = audio_bubbles(product, 20, :li)%><%= audio_bubble[:audio] unless audio_bubble[:audio].blank?%></ul></td>
        <td><ul class="lang"><% subtitles = subtitle_bubbles(product, 20, :li) %><%= subtitles[:sub] unless subtitles[:sub].blank?%></ul></td>
        <td>
          <table>
            <tr>
              <td width="100" align="center">
                <%= f.label :priority_1, image_tag('high.gif', :alt => 'High', :size => '20x10'), :title => 'priority high' %>
                <%= f.radio_button :priority, '1', :checked => DVDPostConfig[:default_wishlist_priority] == :high, :title => 'priority high' %>
              </td>
            </tr>
            <tr>
              <td width="100" align="center">
                <%= f.label :priority_2, image_tag('med.gif', :alt => 'Medium', :size => '20x10'), :title => 'priority medium' %>
                <%= f.radio_button :priority, '2', :checked => DVDPostConfig[:default_wishlist_priority] == :medium, :title => 'priority medium' %>
              </td>
            </tr>
            <tr>
              <td width="100" align="center">
                <%= f.label :priority_3, image_tag('low.gif', :alt => 'Low', :size => '20x10'), :title => 'priority low' %>
                <%= f.radio_button :priority, '3', :checked => DVDPostConfig[:default_wishlist_priority] == :low, :title => 'priority low' %>
              </td>
            </tr>
          </table>
        </td>
        <td id="add_to_wishlist">
          <% type_button = product.next.to_i == 1 ? :reserve : :normal %>
          <%= f.submit title_add_to_wishlist(:long, type_button, media), :class => 'item', :title => title_add_to_wishlist(:long, type_button, media) %>
          <%= f.submit title_add_all_to_wishlist(type_button), :class => 'serie', :name => 'add_all_from_series', :title => t('.add_serie') if product.series? %>
        </td>
      </tr>
      </table>
      <% end %>
    <% end %>
  <% end %>

  
<% else %>
  
<% end %>
